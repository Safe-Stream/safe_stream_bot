# Safe Stream Bot Modifications

## –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è Safe Stream VPN –±–æ—Ç–∞

### 1. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (Branding)

#### `locales/ru.json`
- –ò–∑–º–µ–Ω–µ–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –±—Ä–µ–Ω–¥–∏–Ω–≥ Safe Stream
- "Connection key" ‚Üí "Activation key" (–∫–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ VPN —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã —Ç–µ–∫—Å—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

**–ö–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–º–µ–Ω—ã:**
```json
"main_menu_greeting": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {user_name}!\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Safe Stream ‚Äî –≤–∞—à –Ω–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä –¥–ª—è –∑–∞—â–∏—Ç—ã –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–º –º–∏—Ä–µ. üåç\n–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–π VPN —Å –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å–µ—Ç—å—é —Å–µ—Ä–≤–µ—Ä–æ–≤, –Ω–∞–¥—ë–∂–Ω—ã–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–æ–ª–Ω–æ–π –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å—é, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤–∞—à—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–≤–æ–±–æ–¥—É –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ. üîí\n–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π, –∫—Ç–æ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, —ç—Ç–æ‚Ä¶ –í—ã. üõ°Ô∏è\n–û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ —Å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞. üöÄ\n–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥: ‚¨áÔ∏è",
"menu_instructions_button": "üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
"instructions_text": "üìñ <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é Safe Stream VPN</b>\n\nüîó <b>–®–∞–≥ 1:</b> –ü–æ–ª—É—á–∏—Ç–µ –≤–∞—à –∫–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ \"üîê –ú–æ—è –ø–æ–¥–ø–∏—Å–∫–∞\"\n\nüì± <b>–®–∞–≥ 2:</b> –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:\n‚Ä¢ üì± <b>Android:</b> <a href=\"https://play.google.com/store/apps/details?id=com.v2ray.ang\">V2rayNG</a>\n‚Ä¢ üçé <b>iOS:</b> <a href=\"https://apps.apple.com/app/shadowrocket/id932747118\">Shadowrocket</a> (–ø–ª–∞—Ç–Ω–æ–µ)\n‚Ä¢ üíª <b>Windows:</b> <a href=\"https://github.com/2dust/v2rayN/releases\">v2rayN</a>\n‚Ä¢ üêß <b>Linux:</b> <a href=\"https://github.com/v2fly/v2ray-core\">V2Ray</a>\n‚Ä¢ üñ• <b>macOS:</b> <a href=\"https://github.com/yanue/V2rayU/releases\">V2rayU</a>\n\n‚öôÔ∏è <b>–®–∞–≥ 3:</b> –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤–∞—à –∫–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\n‚Ä¢ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á –∏–∑ –±–æ—Ç–∞\n‚Ä¢ –í—Å—Ç–∞–≤—å—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥\n‚Ä¢ –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É\n\n‚úÖ <b>–ì–æ—Ç–æ–≤–æ!</b> –¢–µ–ø–µ—Ä—å –≤–∞—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞—â–∏—â–µ–Ω–æ Safe Stream VPN\n\nüí° <b>–í–∞–∂–Ω–æ:</b> –û–¥–∏–Ω –∫–ª—é—á –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ 5 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n\nüÜò –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É!"
```

#### `locales/en.json`
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞

### 2. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (UI Layout)

#### `bot/keyboards/inline/user_keyboards.py`
**–°—Ç—Ä–æ–∫–∏ 36-43**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"
```python
# –ö–Ω–æ–ø–∫–∏ "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏" –∏ "–†–µ—Ñ–µ—Ä–∞–ª—ã" –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
instructions_button = InlineKeyboardButton(
    text=_(key="menu_instructions_button"),
    callback_data="main_action:instructions")
referral_button = InlineKeyboardButton(
    text=_(key="menu_referral_inline"),
    callback_data="main_action:referral")

builder.row(instructions_button, referral_button)
```

#### `bot/handlers/user/start.py`
**–°—Ç—Ä–æ–∫–∏ 661-666**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"
```python
elif action == "instructions":
    await callback.answer()
    await callback.message.edit_text(
        text=_(key="instructions_text"),
        reply_markup=get_main_menu_keyboard(i18n),
    )
```

### 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

#### `bot/handlers/user/subscription/core.py`
**–°—Ç—Ä–æ–∫–∏ 183-220**: –î–æ–±–∞–≤–ª–µ–Ω —Å—á–µ—Ç—á–∏–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
current_devices_display = "?"
user_uuid = active.get("user_id")
devices_response = None
if user_uuid:
    try:
        devices_response = await panel_service.get_user_devices(user_uuid)
    except Exception:
        logging.exception("Failed to load devices for user %s", user_uuid)
if devices_response:
    devices_count: Optional[int] = None
    if isinstance(devices_response, dict):
        devices_list = devices_response.get("devices")
        if isinstance(devices_list, list):
            devices_count = len(devices_list)
        # ... –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

### 4. Docker Configuration

#### `docker-compose.yml`
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `safe-stream-`:
  - `remnawave-bot` ‚Üí `safe-stream-bot`
  - `remnawave-db` ‚Üí `safe-stream-db`
  - `remnawave-network` ‚Üí `safe-stream-network`
  - `remnawave-db-data` ‚Üí `safe-stream-db-data`

### 5. –§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

**Backup —Ñ–∞–π–ª—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω—ã –ø–æ –æ—à–∏–±–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ):**
- `locales/ru.json.save`
- `locales/ru.json.save.1`
- `locales/ru.json.save.2`
- `locales/ru.json.save.3`
- `locales/ru.json.save.4`
- `locales/ru.json.save.5`

### 6. –ü–ª–∞–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–∫**
2. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å Docker –∏–∑–º–µ–Ω–µ–Ω–∏—è** (docker-compose.yml)
3. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å UI –∏–∑–º–µ–Ω–µ–Ω–∏—è** (keyboards –∏ handlers)
4. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (subscription core)
5. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é** (ru.json –∏ en.json)
6. **–£–¥–∞–ª–∏—Ç—å backup —Ñ–∞–π–ª—ã**
7. **–ö–æ–º–º–∏—Ç –∏ push –∏–∑–º–µ–Ω–µ–Ω–∏–π**

### 7. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏

- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º API
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ Safe Stream —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- ‚úÖ –ù–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç–∞ –ª–æ–≥–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–∏–º—ã –∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å upstream

### 8. Upstream Synchronization

–ù–∞—Å—Ç—Ä–æ–µ–Ω remote `upstream` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º:
```bash
git remote add upstream https://github.com/machka-pasla/remnawave-tg-shop.git
```

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç upstream:
```bash
git fetch upstream
git merge upstream/main
```